<% latest_date = PaperTrail.select(:insertion_date).max %>

<% if latest_date.nil? %>
  <h1>All traffic this website knows of so far</h1>
<% else %>
  <h1>All traffic CyberAdapt has caught, up to <%= latest_date.insertion_date %></h1>
<% end %>

<%= link_to "Pull new log entries from CyberAdapt", uri_entries_refresh_path %>

<%= link_to "Upload", uri_entries_upload_path %>

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Machine</th>
      <th>URI</th>
      <th>Hits</th>
      <th>Was recorded on</th>
      <th>Was put into the database at</th>
      <th>Was last updated at</th>
    </tr>
  </thead>
  <tbody>
    <% @uri_entries.each do |row| %>
      <tr>
        <%= content_tag :td, row.id %>
        <%= content_tag :td, row.machine&.ip %>
        <%= content_tag :td, row.uri %>
        <%= content_tag :td, row.hits %>
        <%= content_tag :td, row.paper_trail&.insertion_date %>
        <%= content_tag :td, row.created_at %>
        <%= content_tag :td, row.updated_at %>
      </tr>
    <% end %>
  </tbody>
</table>
