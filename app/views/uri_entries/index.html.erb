<div class="ui container">
  <%= render 'shared/index_header',
             title: "CyberAdapt traffic log",
             model: UriEntry,
             var: @uri_entries %>

  <%= render 'uri_entries/search' %>
  
  <%= link_to "Pull new log entries from CyberAdapt", uri_entries_refresh_path %>
  <br>
  <%= link_to "Download ALL these results as a CSV", uri_entries_path(params.to_unsafe_hash.merge(format: :csv)) %>
  
  <%= will_paginate @uri_entries %>
</div>

<table class="ui striped celled table">
  <thead>
    <tr>
      <th>ID</th>
      <th>IP</th>
      <th>User</th>
      <th>Host</th>
      <th>URI</th>
      <th>Hits</th>
      <th>CyberAdapt recorded this on</th>
      <th>Was put into the database at</th>
      <th>Was last updated at</th>
    </tr>
  </thead>
  <tbody>
    <% @uri_entries.find_each do |record| %>
      <tr>
        <td><%= record.id                          %></td>
        <td><%= record.dhcp_lease.ip               %></td>
        <td><%= record.machine&.user               %></td>
        <td><%= record.machine&.host               %></td>
        <td><%= record.uri                         %></td>
        <td><%= record.hits                        %></td>
        <td><%= record.paper_trail&.insertion_date %></td>
        <td><%= record.created_at                  %></td>
        <td><%= record.updated_at                  %></td>
      </tr>
    <% end %>
  </tbody>
</table>
